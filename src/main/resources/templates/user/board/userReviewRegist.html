<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://unpkg.com/ress/dist/ress.min.css" rel="stylesheet" type="text/css">
    <link href="/css/userBoard.css" rel="stylesheet" type="text/css">
    <script src="/javaScript/event.js" type="text/javascript"></script>
    <script src="/javaScript/modalEvent.js" type="text/javascript"></script>
    <title>Title</title>
</head>
<body>
<button id="btn-modal">작성하기</button>

<!-- 모달창 -->
<div id="modal" class="modal-overlay">
    <div class="modal-detail">
        <div class="close-area">X</div>
        <div class="reviewModalTitle">
            <h3 class="reviewTitle">후기 쓰기</h3>
        </div>
        <form id="reviewForm" action="/user/board/regist" method="post" enctype="multipart/form-data" >
            <div class="content">
                <div class="rating">
                        <span class="text-bold">별점을 선택해주세요</span>
                        <input type="radio" name="rating" value="5" id="rate1"><label
                            for="rate1">★</label>
                        <input type="radio" name="rating" value="4" id="rate2"><label
                            for="rate2">★</label>
                        <input type="radio" name="rating" value="3" id="rate3"><label
                            for="rate3">★</label>
                        <input type="radio" name="rating" value="2" id="rate4"><label
                            for="rate4">★</label>
                        <input type="radio" name="rating" value="1" id="rate5"><label
                            for="rate5">★</label>
<!--                        <input type="checkbox" name="rating" id="rating1" value="1" class="rate_radio" title="1점">-->
<!--                        <label for="rating1"></label>-->
<!--                        <input type="checkbox" name="rating" id="rating2" value="2" class="rate_radio" title="2점">-->
<!--                        <label for="rating2"></label>-->
<!--                        <input type="checkbox" name="rating" id="rating3" value="3" class="rate_radio" title="3점" >-->
<!--                        <label for="rating3"></label>-->
<!--                        <input type="checkbox" name="rating" id="rating4" value="4" class="rate_radio" title="4점">-->
<!--                        <label for="rating4"></label>-->
<!--                        <input type="checkbox" name="rating" id="rating5" value="5" class="rate_radio" title="5점">-->
<!--                        <label for="rating5"></label>-->
                    </div>
                </div>
                <div>
                    <h4 class="reviewModal">사진 첨부</h4>
                    <p>사진을 첨부해주세요.(최대 1장)</p>
                    <div class="reviewBox">
                        <div class="image-area"><img src="/images/camera.png"><p>사진 첨부하기</p></div>
                    </div>
                </div>
                <div>
                    <h4 class="reviewModal">제목</h4>
                    <div class="reviewBox">
                        <input type="text" name="title" class="reviewregist-name">
                    </div>
                </div>
                <div>
                    <h4 class="reviewModal">리뷰 작성</h4>
                    <div class="reviewBox">
                        <textarea name="body" cols="60" rows="15" class="reviewregist-body"
                                  placeholder="자세하고 솔직한 리뷰는 다른 고객에게 큰 도움이 됩니다."></textarea>
                    </div>
                </div>
                <div class="file">
                    <input type="file" name="attachImage" accept="image/jpeg,image/png">
                </div>
                <br>
                <div class="reviewBox">
                    <div class="reviewDML2">
                        <button type="submit" id="save">완 료</button>
                    </div>
                </div>
             </form>
        </div>
    </div>
</div>

<script>
    // //별점 마킹 모듈 프로토타입으로 생성
    // function Rating(){}
    // Rating.prototype.rate = 0;
    // Rating.prototype.setRate = function(newrate){
    //     //별점 마킹 - 클릭한 별 이하 모든 별 체크 처리
    //     this.rate = newrate;
    //     let items = document.querySelectorAll('.rate_radio');
    //     items.forEach(function(item, idx){
    //         if(idx < newrate){
    //             item.checked = true;
    //         }else{
    //             item.checked = false;
    //         }
    //         // item.checked = idx < newrate;
    //         console.log(item);
    //     });
    // }
    // let rating = new Rating();//별점 인스턴스 생성
    //
    // document.addEventListener('DOMContentLoaded', function(){
    //     //별점선택 이벤트 리스너
    //     document.querySelector('.rating').addEventListener('click',function(e){
    //         let elem = e.target;
    //         if(elem.classList.contains('rate_radio')){
    //             rating.setRate(parseInt(elem.value));
    //
    //             console.log();
    //         }
    //     })
    // });

    // //상품평 작성 글자수 초과 체크 이벤트 리스너
    // document.querySelector('.reviewregist-body').addEventListener('keydown',function(){
    //     //리뷰 400자 초과 안되게 자동 자름
    //     let review = document.querySelector('.reviewregist-body');
    //     let lengthCheckEx = /^.{400,}$/;
    //     if(lengthCheckEx.test(review.value)){
    //         //400자 초과 컷
    //         review.value = review.value.substr(0,400);
    //     }
    // });
    //
    // //저장 전송전 필드 체크 이벤트 리스너
    // document.querySelector('#save').addEventListener('click', function(e){
    //     //별점 선택 안했으면 메시지 표시
    //     if(rating.rate == 0){
    //         rating.showMessage('별점을 체크해주세요.');
    //         return false;
    //     }
    //     //리뷰 5자 미만이면 메시지 표시
    //     if(document.querySelector('.reviewregist-body').value.length < 5){
    //         rating.showMessage('리뷰 내용 5자 이상 작성해주세요.');
    //         return false;
    //     }
    //     //폼 서밋
    // });

    (function (){
        /* div image area 요소 */
        const imageArea = document.querySelectorAll(".image-area");
        /* input type=file 요소 */
        const fileElements = document.querySelectorAll("[type=file]");
        /* div 클릭 시 open 함수 동작하여 input type=file 클릭 */
        imageArea.forEach(item => item.addEventListener('click', open));
        /* 파일 첨부가 발생하는 상황에 preview 함수 동작 */
        fileElements.forEach(item => item.addEventListener('change', preview));

        function open() {
            const index = Array.from(imageArea).indexOf(this);
            fileElements[index].click();
        }

        function preview() {
            const index = Array.from(fileElements).indexOf(this);
            /* 첨부 된 파일이 존재한다면 */
            if(this.files && this.files[0]) {
                const reader = new FileReader();
                reader.readAsDataURL(this.files[0]);
                /* 파일 로드 후 동작하는 이벤트 설정 */
                reader.onload = function () {
                    console.log(reader.result);
                    imageArea[index].innerHTML = `<img src='${reader.result}' style='width:50px;height:50px'>`;
                }
            }
        }

    })();
</script>

</body>
</html>